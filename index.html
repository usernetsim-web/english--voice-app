<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Игра на перевод (англ ↔ рус)</title>
<style>
  body {
    margin: 0; padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #121212;
    color: #eee;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    overflow: hidden;
    user-select: none;
  }
  h1 {
    margin-bottom: 1rem;
  }
  #word {
    font-size: 4rem;
    font-weight: 700;
    margin: 2rem 0;
    transition: transform 0.8s ease, opacity 0.8s ease;
  }
  #word.fly-up {
    transform: translateY(-150vh) rotate(720deg);
    opacity: 0;
  }
  #status {
    font-size: 1.2rem;
    margin-bottom: 1rem;
    min-height: 1.4em;
  }
  #start-btn {
    font-size: 1.5rem;
    padding: 1rem 2rem;
    border: none;
    border-radius: 10px;
    background: #0a84ff;
    color: white;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  #start-btn:hover:not(:disabled) {
    background: #0066ff;
  }
  #start-btn:disabled {
    background: #555;
    cursor: not-allowed;
  }
</style>
</head>
<body>

<h1>Игра: переведи слово</h1>
<div id="word">...</div>
<div id="status">Нажмите "Старт" и скажите перевод</div>
<button id="start-btn">Старт</button>

<audio id="shot-sound" src="https://actions.google.com/sounds/v1/weapons/shotgun_fire.ogg" preload="auto"></audio>

<script>
(() => {
  const wordEl = document.getElementById('word');
  const statusEl = document.getElementById('status');
  const startBtn = document.getElementById('start-btn');
  const shotSound = document.getElementById('shot-sound');

  // Словарь: английское слово → русское
  const dictionary = [
    { en: "apple", ru: "яблоко" },
    { en: "cat", ru: "кот" },
    { en: "dog", ru: "собака" },
    { en: "house", ru: "дом" },
    { en: "car", ru: "машина" },
    { en: "sun", ru: "солнце" },
    { en: "water", ru: "вода" },
    { en: "book", ru: "книга" },
    { en: "tree", ru: "дерево" },
    { en: "bird", ru: "птица" }
  ];

  let currentWord = null;
  let currentLang = null; // "en" или "ru"
  let recognition = null;
  let listening = false;

  // Инициализация распознавания речи
  function initRecognition() {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
      alert('Ваш браузер не поддерживает распознавание речи. Используйте Chrome или Edge.');
      startBtn.disabled = true;
      return null;
    }
    const recog = new SpeechRecognition();
    recog.lang = 'ru-RU'; // распознаём русский (т.к. ответы на русском и английском произносим по-русски)
    recog.interimResults = false;
    recog.maxAlternatives = 1;
    recog.continuous = false;
    return recog;
  }

  function pickWord() {
    // Случайное слово из словаря
    const idx = Math.floor(Math.random() * dictionary.length);
    currentWord = dictionary[idx];
    // Случайно выбираем язык, на котором показываем слово
    currentLang = Math.random() < 0.5 ? "en" : "ru";
    wordEl.textContent = currentWord[currentLang];
    wordEl.classList.remove('fly-up');
    statusEl.textContent = 'Скажите перевод на ' + (currentLang === 'en' ? 'русском' : 'английском');
  }

  function normalizeText(text) {
    return text.trim().toLowerCase().replace(/[.,!?]/g, '');
  }

  function checkAnswer(answer) {
    answer = normalizeText(answer);
    let correctAnswer = currentLang === 'en' ? currentWord.ru : currentWord.en;
    correctAnswer = normalizeText(correctAnswer);
    return answer === correctAnswer;
  }

  function playShot() {
    shotSound.currentTime = 0;
    shotSound.play();
  }

  function flyWord() {
    return new Promise(resolve => {
      wordEl.classList.add('fly-up');
      // Ждём окончания анимации (~0.8с)
      setTimeout(() => resolve(), 900);
    });
  }

  function startRecognition() {
    if (!recognition) return;
    listening = true;
    startBtn.disabled = true;
    statusEl.textContent = 'Слушаю... Говорите перевод';
    try {
      recognition.start();
    } catch(e) {
      statusEl.textContent = 'Ошибка запуска распознавания.';
      listening = false;
      startBtn.disabled = false;
    }
  }

  function stopRecognition() {
    if (!recognition) return;
    listening = false;
    recognition.stop();
    startBtn.disabled = false;
  }

  startBtn.addEventListener('click', () => {
    if (!listening) {
      startRecognition();
    } else {
      stopRecognition();
    }
  });

  recognition = initRecognition();
  if (!recognition) return;

  recognition.addEventListener('result', async e => {
    if (!e.results || e.results.length === 0) {
      statusEl.textContent = 'Не распознано. Попробуйте ещё раз.';
      return;
    }
    const transcript = e.results[0][0].transcript;
    statusEl.textContent = `Вы сказали: "${transcript}"`;

    if (checkAnswer(transcript)) {
      playShot();
      await flyWord();
      pickWord();
    } else {
      statusEl.textContent = `Неверно. Попробуйте ещё раз.`;
    }
  });

  recognition.addEventListener('error', e => {
    statusEl.textContent = `Ошибка распознавания: ${e.error}`;
    listening = false;
    startBtn.disabled = false;
  });

  recognition.addEventListener('end', () => {
    if (listening) {
      // Автоматически перезапускаем распознавание для удобства
      recognition.start();
    }
  });

  // Запускаем игру сразу с первым словом
  pickWord();
})();
</script>

</body>
</html>
